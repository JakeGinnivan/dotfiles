# Custom word characters for better word navigation
export WORDCHARS='*?[]~=/&;!#$%^(){}<>'

# Disable Oh My Zsh auto-update prompts (we use antidote to manage plugins)
export DISABLE_AUTO_UPDATE="true"
export CLAUDE_CODE_DISABLE_TERMINAL_TITLE="true"

# Zephyr plugin configuration
zstyle ':zephyr:plugin:directory:alias' 'skip' 'yes'
source /opt/homebrew/opt/antidote/share/antidote/antidote.zsh
antidote load
source ~/.zsh_plugins.zsh

# Skip shell initialization in Claude Code (sandbox restrictions)
if [[ -z "$CLAUDE_CODE" ]]; then
  eval "$(op completion zsh)"
  eval "$(zoxide init zsh)"
  eval "$(starship init zsh)"
  eval "$(mcfly init zsh)"
fi

# pnpm aliases (using corepack)
alias p="pnpm"
alias pi="pnpm install"
alias pa="pnpm add"
alias pad="pnpm add -D"
alias pr="pnpm run"
alias px="pnpm exec"
alias prd="pnpm run dev"
alias prb="pnpm run build"
alias prt="pnpm run test"
alias pu="pnpm update"
alias prm="pnpm remove"

# fnm - Fast Node Manager
eval "$(fnm env --use-on-cd --corepack-enabled --shell zsh)"

# Random tool tip on shell startup
function show_random_tip() {
  local tips_file="$HOME/.config/shell-tips.txt"
  if [[ -f "$tips_file" ]]; then
    # Get random tip (excluding comments and empty lines)
    # Use sort -R for macOS compatibility (shuf not available by default)
    local tip=$(grep -v '^#' "$tips_file" | grep -v '^$' | sort -R | head -n 1)
    if [[ -n "$tip" ]]; then
      echo ""
      echo "$tip"
      echo ""
    fi
  fi
}

# Show tip on new interactive shells
show_random_tip

function stitle() {
  echo -en "\033]0;$@\007"
}

# Auto-update terminal title in git directories
function update_terminal_title() {
  # Check if we're in a git repository
  if git rev-parse --is-inside-work-tree &>/dev/null; then
    local folder_name="${PWD:t}"  # Get basename of current directory
    local git_branch=$(git symbolic-ref --short HEAD 2>/dev/null || git rev-parse --short HEAD 2>/dev/null)

    if [[ -n "$git_branch" ]]; then
      # Set terminal title using OSC escape sequence
      stitle "${folder_name} - ${git_branch}"
    fi
  fi
}

# Run on directory change and after every command
autoload -Uz add-zsh-hook
add-zsh-hook chpwd update_terminal_title
add-zsh-hook precmd update_terminal_title

# Set title for current directory on shell startup
update_terminal_title
